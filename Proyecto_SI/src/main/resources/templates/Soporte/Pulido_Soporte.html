<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{Dashboard :: layout(~{::title}, ~{::content})}">
<head>
    <title th:fragment="title">Pulido | Soporte</title>
</head>
<body>

<main class="content-area" th:fragment="content">

    <div class="view-header">
        <a th:href="@{/soporte/dashboard}" class="back-button">
            <i class="fas fa-arrow-left"></i>
        </a>
        <h1 class="content-title">Pulido (Soporte)</h1>
    </div>

    <div class="filters-container">
        <div class="filter-group-top">
            <select class="filter-select">
                <option value="">Selecciona sucursal</option>
                <option value="matriz">Matriz</option>
                <option value="sucursal-a">Sucursal A</option>
                <option value="sucursal-b">Sucursal B</option>
            </select>

            <input type="date" class="filter-input">

            <button class="filter-button">Confirmar</button>

            <button id="btnEditarModo" class="action-button-primary" style="margin-left: 1rem; background-color: #3b5998;">
                <i class="fas fa-pen"></i> Editar Tabla
            </button>

            <button id="btnAgregarFila" class="action-button-primary" style="margin-left: 0.5rem; background-color: #08335e; display: none;">
                <i class="fas fa-plus"></i> Fila
            </button>
        </div>
    </div>

    <div class="table-container table-container-wide">
        <table id="tablaPulido" class="data-table table-pulido">
            <thead>
            <tr>
                <th class="col-sticky">No. Ticket</th>
                <th>Armazón</th>
                <th>Material</th>
                <th>Bisel</th>
                <th>Serie</th>
                <th>Forma pago</th>
                <th>VT</th>
                <th>Comisión</th>
                <th>Meses</th>
                <th>$ Armazón</th>
                <th>$ Mica</th>
                <th>IVA Mica</th>
                <th>Total Mica</th>
                <th>Bisel/Tallado</th>
                <th>IVA Bisel</th>
                <th>Total Bisel</th>
                <th>L/C</th>
                <th>IVA L/C</th>
                <th>Total L/C</th>
                <th>Otros gastos</th>
                <th>IVA Ot. Gt.</th>
                <th>Kit entrega</th>
                <th>Total Ot. Gt.</th>
                <th>Total sin costos</th>
                <th>Nombre Opt.</th>
                <th>Con gastos</th>
                <th>Sin gastos</th>
                <th>Acción</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td class="col-sticky">#8801</td>
                <td>Armazon A1</td>
                <td>Poli</td>
                <td>Ranurado</td>
                <td>SR-200</td>
                <td>Tarjeta</td>
                <td>$4,200</td>
                <td>$180</td>
                <td>3</td>
                <td>$1,200</td>
                <td>$700</td>
                <td>$112</td>
                <td>$812</td>
                <td>$260</td>
                <td>$41</td>
                <td>$301</td>
                <td>$0</td>
                <td>$0</td>
                <td>$0</td>
                <td>$45</td>
                <td>$7</td>
                <td>No</td>
                <td>$52</td>
                <td>$2,100</td>
                <td>Pedro L.</td>
                <td>$1,600</td>
                <td>$2,000</td>
                <td><button class="icon-btn-edit"><i class="fas fa-edit"></i></button></td>
            </tr>
            <tr>
                <td class="col-sticky">#8802</td>
                <td>Armazon B5</td>
                <td>CR39</td>
                <td>Completo</td>
                <td>SR-201</td>
                <td>Efectivo</td>
                <td>$2,900</td>
                <td>$140</td>
                <td>0</td>
                <td>$950</td>
                <td>$480</td>
                <td>$76</td>
                <td>$556</td>
                <td>$210</td>
                <td>$33</td>
                <td>$243</td>
                <td>$80</td>
                <td>$13</td>
                <td>$93</td>
                <td>$0</td>
                <td>$0</td>
                <td>Sí</td>
                <td>$93</td>
                <td>$1,700</td>
                <td>Lucía R.</td>
                <td>$1,150</td>
                <td>$1,450</td>
                <td><button class="icon-btn-edit"><i class="fas fa-edit"></i></button></td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="pulido-summary-container">

        <div class="summary-box">
            <div class="summary-header header-blue-dark">CON GASTOS</div>
            <div class="summary-content">
                <div class="summary-row"><span>Optometrista 1</span> <strong>$4,200</strong></div>
                <div class="summary-row"><span>Optometrista 2</span> <strong>$2,900</strong></div>
                <div class="summary-total total-dark">Total: $7,100</div>
            </div>
        </div>

        <div class="summary-box">
            <div class="summary-header header-blue-light">SIN GASTOS</div>
            <div class="summary-content">
                <div class="summary-row"><span>Optometrista 1</span> <strong>$6,000</strong></div>
                <div class="summary-row"><span>Optometrista 2</span> <strong>$3,500</strong></div>
                <div class="summary-total total-light">Total: $9,500</div>
            </div>
        </div>

    </div>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const btnEditar = document.getElementById('btnEditarModo');
            const btnAgregar = document.getElementById('btnAgregarFila');
            const tabla = document.getElementById('tablaPulido');
            let esEditable = false;

            btnEditar.addEventListener('click', function() {
                esEditable = !esEditable;

                const celdas = tabla.querySelectorAll('tbody td:not(.col-sticky)');

                celdas.forEach(celda => {
                    celda.setAttribute('contenteditable', esEditable);
                });

                const tickets = tabla.querySelectorAll('tbody td.col-sticky');
                tickets.forEach(t => t.setAttribute('contenteditable', esEditable));

                if (esEditable) {
                    btnEditar.innerHTML = '<i class="fas fa-save"></i> Guardar Cambios';
                    btnEditar.style.backgroundColor = '#28a745';
                    tabla.classList.add('modo-edicion');
                    btnAgregar.style.display = 'inline-flex';
                } else {
                    btnEditar.innerHTML = '<i class="fas fa-pen"></i> Editar Tabla';
                    btnEditar.style.backgroundColor = '#3b5998';
                    tabla.classList.remove('modo-edicion');
                    btnAgregar.style.display = 'none';
                    alert("Cambios guardados visualmente.");
                }
            });

            btnAgregar.addEventListener('click', function() {
                const tbody = tabla.querySelector('tbody');
                const ultimaFila = tbody.lastElementChild;
                const nuevaFila = ultimaFila.cloneNode(true);

                Array.from(nuevaFila.cells).forEach(celda => {
                    celda.innerText = '';

                    if (celda.querySelector('button')) {
                        celda.innerHTML = '<button class="icon-btn-edit"><i class="fas fa-edit"></i></button>';
                    }

                    celda.setAttribute('contenteditable', 'true');
                });

                nuevaFila.querySelector('.col-sticky').innerText = '#Nuevo';
                tbody.appendChild(nuevaFila);

                const container = document.querySelector('.table-container-wide');
                container.scrollTop = container.scrollHeight;
            });
        });
    </script>
</main>

</body>
</html>