<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{Dashboard :: layout(~{::title}, ~{::content})}">
<head>
    <title th:fragment="title">Estado de Cuenta Proveedores | Admin</title>
</head>
<body>

<main class="content-area" th:fragment="content">

    <div class="view-header">
        <a th:href="@{/admin/dashboard}" class="back-button">
            <i class="fas fa-arrow-left"></i>
        </a>
        <h1 class="content-title">Estado de cuenta de Proveedores</h1>
    </div>

    <div class="filters-container">

        <div class="filter-row-distributed" style="margin-bottom: 1rem;">
            <select class="filter-select">
                <option value="">Selecciona sucursal</option>
                <option value="matriz">Matriz</option>
                <option value="sucursal-a">Sucursal A</option>
                <option value="sucursal-b">Sucursal B</option>
            </select>

            <select class="filter-select">
                <option value="">Selecciona proveedor</option>
                <option value="luxottica">Luxottica</option>
                <option value="marchon">Marchon</option>
                <option value="safilo">Safilo</option>
            </select>

            <button id="btnEditarModo" class="action-button-primary" style="background-color: #3b5998; margin-left: auto;">
                <i class="fas fa-pen"></i> Editar
            </button>

            <button id="btnAgregarFila" class="action-button-primary" style="margin-left: 0.5rem; background-color: #17a2b8; display: none;">
                <i class="fas fa-plus"></i> Nueva Factura
            </button>
        </div>

        <div class="search-bar-container" style="width: 100%;">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" placeholder="Buscar por fecha o factura">
        </div>
    </div>

    <div class="table-container">
        <table id="tablaProveedores" class="data-table table-responsive-cards">
            <thead>
            <tr>
                <th>Fecha</th>
                <th>Cantidad por día</th>
                <th>Pago</th>
                <th>Factura</th>
                <th>Imagen</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td data-label="Fecha">20/11/2025</td>
                <td data-label="Cant. por día">15 pzas</td>
                <td data-label="Pago">$15,000.00</td>
                <td data-label="Factura">FAC-A001</td>
                <td data-label="Imagen">
                    <button class="icon-btn-view"><i class="fas fa-image"></i> Ver</button>
                </td>
            </tr>
            <tr>
                <td data-label="Fecha">19/11/2025</td>
                <td data-label="Cant. por día">8 pzas</td>
                <td data-label="Pago">$8,000.00</td>
                <td data-label="Factura">FAC-A002</td>
                <td data-label="Imagen">
                    <button class="icon-btn-view"><i class="fas fa-image"></i> Ver</button>
                </td>
            </tr>
            <tr>
                <td data-label="Fecha">18/11/2025</td>
                <td data-label="Cant. por día">20 pzas</td>
                <td data-label="Pago">$22,500.00</td>
                <td data-label="Factura">FAC-B105</td>
                <td data-label="Imagen">
                    <button class="icon-btn-view"><i class="fas fa-image"></i> Ver</button>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="totals-bar">
            <div class="total-item">TOTAL: $45,500.00</div>
            <div class="total-item">TOTAL MAS IVA: $52,780.00</div>
            <div class="total-item">TOTAL POR PROVEEDORES: $45,500.00</div>
        </div>
    </div>


    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const btnEditar = document.getElementById('btnEditarModo');
            const btnAgregar = document.getElementById('btnAgregarFila'); // Referencia al nuevo botón
            const tabla = document.getElementById('tablaProveedores');
            let esEditable = false;

            // --- 1. Modo Edición ---
            btnEditar.addEventListener('click', function() {
                esEditable = !esEditable;

                // Hacemos editables todas las celdas MENOS la última (botón ver imagen)
                const celdas = tabla.querySelectorAll('tbody td:not(:last-child)');
                celdas.forEach(c => c.setAttribute('contenteditable', esEditable));

                if (esEditable) {
                    // MODO ON
                    this.innerHTML = '<i class="fas fa-save"></i> Guardar';
                    this.style.backgroundColor = '#28a745';
                    tabla.classList.add('modo-edicion');

                    btnAgregar.style.display = 'inline-flex'; // ¡Aparece el botón! ✨
                } else {
                    // MODO OFF
                    this.innerHTML = '<i class="fas fa-pen"></i> Editar';
                    this.style.backgroundColor = '#3b5998';
                    tabla.classList.remove('modo-edicion');

                    btnAgregar.style.display = 'none'; // Se esconde

                    alert("Datos guardados (incluyendo nuevas facturas).");
                }
            });

            // --- 2. Agregar Nueva Fila ---
            btnAgregar.addEventListener('click', function() {
                const tbody = tabla.querySelector('tbody');
                const primeraFila = tbody.rows[0]; // Usamos la primera como molde

                // Clonamos la fila
                const nuevaFila = primeraFila.cloneNode(true);

                // Limpiamos el texto de las celdas clonadas
                Array.from(nuevaFila.cells).forEach((celda, index) => {
                    // Si NO es la celda del botón de imagen, borramos el texto
                    if (!celda.querySelector('button')) {
                        celda.innerText = '';
                        celda.setAttribute('contenteditable', 'true'); // Aseguramos que sea editable
                    }

                    // Opcional: Poner fecha de hoy por defecto en la primera celda
                    if(index === 0) {
                        celda.innerText = new Date().toLocaleDateString('es-ES');
                    }
                });

                // Insertamos la nueva fila al principio de la tabla
                tbody.insertBefore(nuevaFila, tbody.firstChild);
            });

            // Botones de ver imagen (simulados)
            // Usamos delegación de eventos para que funcione también en las filas nuevas
            tabla.addEventListener('click', function(e) {
                if(e.target.closest('.icon-btn-view')) {
                    alert("Aquí se abriría el modal con la foto de la factura.");
                }
            });
        });
    </script>

</main>
</body>
</html>